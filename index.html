<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>✍️Handwritten Character Recognizer</title>
    <style>
        :root {
            --surface-color: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --primary-text-color: #e0e0e0;
            --secondary-text-color: #a0a0a0;
            --accent-purple: #ab68d5;
            --accent-purple-hover: #9b59b6;
        }

        /* --- Animation Keyframes --- */
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* --- Main Styles --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--primary-text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            flex-direction: column;
            overflow: hidden;
            background: linear-gradient(135deg, #1a0c24, #121212, #240c1a);
            background-size: 400% 400%;
            animation: moveGradient 15s ease infinite;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 10px rgba(155, 89, 182, 0.3);
            background: linear-gradient(45deg, #d89fff, #ab68d5, #ffffff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: fadeInUp 1s ease forwards;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            gap: 2.5rem;
            background: var(--surface-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 2.5rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            opacity: 0;
            animation: fadeInUp 1s ease 0.3s forwards;
        }

        canvas {
            background: #fff;
            touch-action: none;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            /* SVG version of the Font Awesome 'fa-pen' icon, set as the cursor */
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 512 512'><path fill='black' d='M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z'/></svg>") 2 30, auto;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            width: 280px;
        }

        .input-group, .button-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        #label {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            color: var(--primary-text-color);
            padding: 12px;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #label:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 10px var(--accent-purple);
        }

        button {
            background-color: var(--accent-purple);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        button:hover {
            background-color: var(--accent-purple-hover);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        #clear {
            background-color: #444;
        }
        #clear:hover {
            background-color: #555;
        }

        #result {
            margin-top: 8px;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Courier New', Courier, monospace;
            min-height: 80px;
            border: 1px solid var(--border-color);
            color: var(--secondary-text-color);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Handwritten Recognizer</h1>
    <div class="container">
        <canvas id="c" width="280" height="280"></canvas>
        <div class="controls">
            <div class="button-group">
                <button id="predict">Predict</button>
                <button id="clear">Clear Canvas</button>
            </div>
            <div class="input-group">
                <input id="label" placeholder="Enter correct label (0-9 or a-z)" />
                <button id="trainBtn">Train with this</button>
            </div>
            <div id="result">Prediction will appear here...</div>
        </div>
    </div>

    <script>
        // --- JavaScript remains the same ---
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = 'white';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.lineWidth = 18;
        ctx.lineCap = 'round';
        ctx.strokeStyle = 'black';

        let drawing = false;
        function pos(e){
            const rect = canvas.getBoundingClientRect();
            if(e.touches && e.touches[0]) e = e.touches[0];
            return {x: e.clientX - rect.left, y: e.clientY - rect.top};
        }
        canvas.addEventListener('pointerdown', e => { drawing = true; const p = pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y); });
        canvas.addEventListener('pointermove', e => { if (!drawing) return; const p = pos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); });
        canvas.addEventListener('pointerup', e => drawing = false);
        canvas.addEventListener('pointerleave', e => drawing = false);

        document.getElementById('clear').onclick = () => {
            ctx.fillStyle='white'; ctx.fillRect(0,0,canvas.width,canvas.height);
            document.getElementById('result').innerText = 'Prediction will appear here...';
        }

        function getImageDataURL(){ return canvas.toDataURL('image/png'); }

        async function api(endpoint, body){
            const res = await fetch(endpoint, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify(body)
            });
            return res.json();
        }

        document.getElementById('predict').onclick = async () => {
            document.getElementById('result').innerText = 'Predicting...';
            const img = getImageDataURL();
            const r = await api('/predict', {image: img});
            if(r && r.pred_char){
                document.getElementById('result').innerText =
                    `Prediction: ${r.pred_char}\n\nTop 3:\n` +
                    `${r.topk.map(x => `  ${x.char}: ${(x.prob * 100).toFixed(1)}%`).join('\n')}`;
            } else {
                document.getElementById('result').innerText = 'Error during prediction.';
            }
        };

        document.getElementById('trainBtn').onclick = async () => {
            const lab = document.getElementById('label').value.trim();
            if(!lab){ alert('Enter a label (0-9 or a-z) to train the model.'); return; }
            document.getElementById('result').innerText = 'Training...';
            const img = getImageDataURL();
            const r = await api('/train', {image: img, label: lab});
            if(r.ok) {
                alert('Training successful! The model has been updated.');
                document.getElementById('result').innerText = `Trained with label "${lab}"\n(Loss: ${r.loss.toFixed(4)})`;
            } else {
                alert('Training error: '+JSON.stringify(r));
                document.getElementById('result').innerText = 'Training failed. See alert for details.';
            }
        };
    </script>
</body>
</html>
